<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CYBERSEARCH - Sistem Menu Digital</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

:root {
--primary-color: #00ffff;
--secondary-color: #ff00ff;
--accent-color: #00ff88;
--dark-bg: #0a0a0f;
--card-bg: rgba(15, 15, 30, 0.7);
--text-primary: #e0e0ff;
--text-secondary: #a0a0c0;
}

body {
font-family: 'Orbitron', 'Courier New', monospace;
background: var(--dark-bg);
color: var(--text-primary);
min-height: 100vh;
overflow-x: hidden;
position: relative;
}

/* Import Google Font */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap');

/* Animated Background - Enhanced */
.bg-animation {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: -1;
background: linear-gradient(135deg, #0a0a1f 0%, #1a0033 50%, #0a0a1f 100%);
overflow: hidden;
}

.particles {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
}

.particle {
position: absolute;
background: var(--primary-color);
border-radius: 50%;
opacity: 0.3;
animation: float 20s infinite linear;
}

.particle:nth-child(2n) {
background: var(--secondary-color);
}

.particle:nth-child(3n) {
background: var(--accent-color);
}

@keyframes float {
0% {
transform: translateY(100vh) translateX(0);
opacity: 0;
}
10% {
opacity: 0.3;
}
90% {
opacity: 0.3;
}
100% {
transform: translateY(-100vh) translateX(100px);
opacity: 0;
}
}

.grid-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image: 
linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
background-size: 40px 40px;
animation: grid-move 10s linear infinite;
}

@keyframes grid-move {
0% {
transform: translate(0, 0);
}
100% {
transform: translate(40px, 40px);
}
}

/* Enhanced Glitch Effect */
@keyframes glitch {
0%, 100% {
text-shadow:
0.05em 0 0 rgba(255, 0, 0, 0.75),
-0.05em -0.025em 0 rgba(0, 255, 0, 0.75),
0.025em 0.05em 0 rgba(0, 0, 255, 0.75);
}
15% {
text-shadow:
-0.05em -0.025em 0 rgba(255, 0, 0, 0.75),
0.025em 0.025em 0 rgba(0, 255, 0, 0.75),
-0.05em -0.05em 0 rgba(0, 0, 255, 0.75);
}
50% {
text-shadow:
0.025em 0.05em 0 rgba(255, 0, 0, 0.75),
0.05em 0 0 rgba(0, 255, 0, 0.75),
0 -0.05em 0 rgba(0, 0, 255, 0.75);
}
}

/* Enhanced Neon Flicker */
@keyframes neon-flicker {
0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
opacity: 1;
text-shadow: 0 0 5px currentColor, 0 0 10px currentColor;
}
20%, 22%, 24%, 55% {
opacity: 0.5;
text-shadow: 0 0 2px currentColor;
}
}

/* Enhanced Scanline Effect */
@keyframes scanline {
0% {
transform: translateY(-100%);
}
100% {
transform: translateY(100%);
}
}

/* Pulse Animation */
@keyframes pulse {
0%, 100% {
opacity: 1;
transform: scale(1);
}
50% {
opacity: 0.7;
transform: scale(0.95);
}
}

/* Enhanced Glow Animation */
@keyframes glow {
0%, 100% {
box-shadow: 0 0 5px var(--primary-color), 0 0 10px var(--primary-color);
}
50% {
box-shadow: 0 0 20px var(--primary-color), 0 0 30px var(--primary-color);
}
}

/* Main Container */
.container {
position: relative;
z-index: 10;
display: flex;
flex-direction: column;
align-items: center;
justify-content: flex-start;
min-height: 100vh;
padding: 20px;
padding-top: 60px; /* Added padding for status bar */
}

/* Enhanced Header */
.header {
text-align: center;
margin-bottom: 48px;
position: relative;
}

.logo-container {
display: flex;
align-items: center;
justify-content: center;
gap: 16px;
margin-bottom: 24px;
position: relative;
}

.hexagon-bg {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
width: 200px;
height: 200px;
background: radial-gradient(circle, rgba(0, 255, 255, 0.1) 0%, rgba(0, 255, 255, 0) 70%);
z-index: -1;
animation: pulse 4s infinite;
}

.icon {
width: 60px;
height: 60px;
position: relative;
}

.icon-cpu {
color: var(--primary-color);
animation: pulse 2s infinite;
filter: drop-shadow(0 0 10px var(--primary-color));
}

.icon-globe {
color: var(--secondary-color);
animation: pulse 2s infinite;
filter: drop-shadow(0 0 10px var(--secondary-color));
}

.icon-glow {
position: absolute;
inset: 0;
width: 60px;
height: 60px;
border-radius: 50%;
filter: blur(20px);
animation: pulse 2s infinite;
}

.cpu-glow {
background: rgba(0, 255, 255, 0.3);
}

.globe-glow {
background: rgba(255, 0, 255, 0.3);
}

.title {
font-size: 4.5rem;
font-weight: 900;
background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
margin: 0;
letter-spacing: 4px;
text-transform: uppercase;
position: relative;
}

.title::after {
content: 'CYBERSEARCH';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(90deg, var(--secondary-color), var(--primary-color), var(--accent-color));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
z-index: -1;
opacity: 0.5;
filter: blur(3px);
}

.subtitle {
color: var(--text-secondary);
font-size: 1.125rem;
margin-top: 16px;
letter-spacing: 2px;
text-transform: uppercase;
}

/* Menu Filter */
.menu-filter {
width: 100%;
max-width: 720px;
margin-bottom: 30px;
position: relative;
}

.filter-container {
position: relative;
display: flex;
gap: 12px;
background: rgba(10, 10, 30, 0.7);
border-radius: 12px;
padding: 4px;
backdrop-filter: blur(10px);
border: 1px solid rgba(0, 255, 255, 0.2);
transition: all 0.3s ease;
}

.filter-container:focus-within {
border-color: rgba(0, 255, 255, 0.5);
box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
}

.filter-input {
flex: 1;
background: transparent;
border: none;
color: var(--text-primary);
font-family: 'Orbitron', monospace;
font-size: 1.125rem;
padding: 18px 24px;
border-radius: 8px;
transition: all 0.3s ease;
}

.filter-input::placeholder {
color: var(--text-secondary);
}

.filter-input:focus {
outline: none;
box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
}

/* Menu Container */
.menu-container {
width: 100%;
max-width: 960px;
display: grid;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
gap: 20px;
margin-bottom: 40px;
}

.menu-card {
background: var(--card-bg);
border: 1px solid rgba(0, 255, 255, 0.2);
border-radius: 12px;
padding: 24px;
backdrop-filter: blur(10px);
transition: all 0.3s ease;
position: relative;
overflow: hidden;
cursor: pointer;
height: 100%;
display: flex;
flex-direction: column;
}

.menu-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 4px;
height: 100%;
background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
}

.menu-card:hover {
transform: translateY(-5px);
box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
border-color: rgba(0, 255, 255, 0.4);
}

.menu-icon {
width: 40px;
height: 40px;
background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
margin-bottom: 16px;
}

.menu-icon svg {
width: 24px;
height: 24px;
fill: var(--dark-bg);
}

.menu-title {
color: var(--primary-color);
font-size: 1.25rem;
font-weight: 700;
margin-bottom: 12px;
text-transform: uppercase;
letter-spacing: 1px;
}

.menu-preview {
color: var(--text-primary);
line-height: 1.6;
flex-grow: 1;
overflow: hidden;
text-overflow: ellipsis;
display: -webkit-box;
-webkit-line-clamp: 3;
-webkit-box-orient: vertical;
}

.menu-badge {
display: inline-block;
background: rgba(0, 255, 255, 0.1);
color: var(--primary-color);
padding: 4px 8px;
border-radius: 4px;
font-size: 0.75rem;
margin-top: 12px;
text-transform: uppercase;
letter-spacing: 1px;
}

/* Detail Modal */
.detail-modal {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(10, 10, 15, 0.9);
backdrop-filter: blur(10px);
z-index: 1000;
display: none;
align-items: center;
justify-content: center;
padding: 20px;
}

.detail-modal.show {
display: flex;
}

.detail-content {
background: var(--card-bg);
border: 1px solid rgba(0, 255, 255, 0.3);
border-radius: 12px;
max-width: 800px;
width: 100%;
max-height: 80vh;
overflow-y: auto;
position: relative;
}

.detail-header {
padding: 24px;
border-bottom: 1px solid rgba(0, 255, 255, 0.2);
display: flex;
align-items: center;
justify-content: space-between;
}

.detail-title {
color: var(--primary-color);
font-size: 1.5rem;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 1px;
}

.detail-close {
background: transparent;
border: none;
color: var(--text-secondary);
cursor: pointer;
width: 32px;
height: 32px;
display: flex;
align-items: center;
justify-content: center;
border-radius: 50%;
transition: all 0.3s ease;
}

.detail-close:hover {
background: rgba(255, 255, 255, 0.1);
color: var(--primary-color);
}

.detail-body {
padding: 24px;
}

.detail-text {
color: var(--text-primary);
line-height: 1.8;
white-space: pre-wrap;
word-break: break-word;
}

.detail-actions {
padding: 16px 24px;
border-top: 1px solid rgba(0, 255, 255, 0.2);
display: flex;
justify-content: flex-end;
gap: 12px;
}

.copy-button {
background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
color: var(--dark-bg);
font-weight: 700;
padding: 10px 20px;
border: none;
border-radius: 6px;
cursor: pointer;
transition: all 0.3s ease;
font-family: 'Orbitron', monospace;
font-size: 0.875rem;
text-transform: uppercase;
letter-spacing: 1px;
position: relative;
overflow: hidden;
}

.copy-button::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
transition: left 0.5s;
}

.copy-button:hover::before {
left: 100%;
}

.copy-button:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
}

.copy-success {
color: var(--accent-color);
font-size: 0.875rem;
margin-left: 12px;
opacity: 0;
transition: opacity 0.3s ease;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 1px;
}

.copy-success.show {
opacity: 1;
}

/* No Menu Items */
.no-menu {
text-align: center;
padding: 60px 0;
width: 100%;
max-width: 960px;
}

.no-menu-title {
color: var(--text-secondary);
font-size: 1.5rem;
font-family: 'Orbitron', monospace;
margin-bottom: 16px;
text-transform: uppercase;
letter-spacing: 2px;
}

.no-menu-subtitle {
color: var(--text-secondary);
font-size: 1rem;
font-family: 'Orbitron', monospace;
opacity: 0.7;
}

/* Enhanced Footer */
.footer {
position: absolute;
bottom: 20px;
left: 0;
right: 0;
text-align: center;
}

.footer-text {
color: var(--text-secondary);
font-size: 0.875rem;
font-family: 'Orbitron', monospace;
text-transform: uppercase;
letter-spacing: 1px;
opacity: 0.7;
}

/* Enhanced Responsive */
@media (max-width: 768px) {
.title {
font-size: 3rem;
}

.menu-container {
grid-template-columns: 1fr;
}
}

/* Custom Scrollbar */
::-webkit-scrollbar {
width: 10px;
}

::-webkit-scrollbar-track {
background: rgba(10, 10, 30, 0.5);
}

::-webkit-scrollbar-thumb {
background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
background: linear-gradient(180deg, var(--secondary-color), var(--primary-color));
}

/* Enhanced Scanline Effect */
.scanline {
position: relative;
}

.scanline::before {
content: "";
position: absolute;
top: 0;
left: 0;
right: 0;
height: 2px;
background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.4), transparent);
animation: scanline 8s linear infinite;
pointer-events: none;
}

/* Enhanced Glitch Text */
.glitch {
animation: glitch 2.5s infinite;
}

/* Enhanced Neon Flicker */
.neon-flicker {
animation: neon-flicker 1.5s infinite;
}

/* Status Bar */
.status-bar {
position: fixed;
top: 0;
left: 0;
right: 0;
background: rgba(10, 10, 30, 0.8);
padding: 8px 20px;
display: flex;
justify-content: space-between;
font-size: 0.75rem;
text-transform: uppercase;
letter-spacing: 1px;
z-index: 100;
backdrop-filter: blur(10px);
border-bottom: 1px solid rgba(0, 255, 255, 0.2);
}

.system-time {
color: var(--primary-color);
}

.system-status {
color: var(--accent-color);
}

/* Terminal Output */
.terminal-output {
background: rgba(10, 10, 30, 0.5);
border: 1px solid rgba(0, 255, 255, 0.2);
border-radius: 8px;
padding: 16px;
margin-top: 20px;
font-family: 'Courier New', monospace;
font-size: 0.875rem;
max-height: 200px;
overflow-y: auto;
display: none;
}

.terminal-line {
margin-bottom: 8px;
color: var(--accent-color);
}

.terminal-prompt {
color: var(--primary-color);
}

.terminal-error {
color: #ff4444;
}

.terminal-success {
color: var(--accent-color);
}

.terminal-warning {
color: #ffaa00;
}

/* Debug Panel */
.debug-panel {
position: fixed;
bottom: 60px;
right: 20px;
background: rgba(10, 10, 30, 0.9);
border: 1px solid rgba(0, 255, 255, 0.3);
border-radius: 8px;
padding: 12px;
font-family: 'Courier New', monospace;
font-size: 0.75rem;
max-width: 300px;
z-index: 100;
display: none;
}

.debug-panel.show {
display: block;
}

.debug-title {
color: var(--primary-color);
margin-bottom: 8px;
font-weight: bold;
}

.debug-info {
color: var(--text-secondary);
margin-bottom: 4px;
}

.debug-toggle {
position: fixed;
bottom: 20px;
right: 20px;
background: rgba(0, 255, 255, 0.2);
border: 1px solid var(--primary-color);
color: var(--primary-color);
padding: 8px 12px;
border-radius: 6px;
cursor: pointer;
font-family: 'Orbitron', monospace;
font-size: 0.75rem;
text-transform: uppercase;
z-index: 100;
}

.debug-toggle:hover {
background: rgba(0, 255, 255, 0.3);
}

/* Loading Spinner */
.loading-container {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 40px;
}

.loading-spinner {
width: 40px;
height: 40px;
border: 3px solid rgba(0, 255, 255, 0.3);
border-top: 3px solid var(--primary-color);
border-radius: 50%;
animation: spin 1s linear infinite;
margin-bottom: 16px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.loading-text {
color: var(--text-secondary);
font-family: 'Orbitron', monospace;
text-transform: uppercase;
letter-spacing: 1px;
}

/* Filter hint */
.filter-hint {
position: absolute;
bottom: -24px;
left: 24px;
font-size: 0.75rem;
color: var(--text-secondary);
opacity: 0.7;
}

/* Match indicator */
.match-indicator {
position: absolute;
top: 8px;
right: 8px;
background: rgba(0, 255, 136, 0.2);
color: var(--accent-color);
padding: 2px 6px;
border-radius: 4px;
font-size: 0.625rem;
text-transform: uppercase;
letter-spacing: 0.5px;
opacity: 0;
transition: opacity 0.3s ease;
}

.menu-card:hover .match-indicator {
opacity: 1;
}
</style>
</head>
<body>
<div class="bg-animation">
<div class="particles" id="particles"></div>
<div class="grid-overlay"></div>
</div>

<!-- Status Bar -->
<div class="status-bar">
<div class="system-time" id="systemTime">--:--:--</div>
<div class="system-status" id="systemStatus">SISTEM INISIALISASI</div>
</div>

<div class="container scanline">
<!-- Header -->
<header class="header">
<div class="logo-container">
<div class="hexagon-bg"></div>
<div class="icon">
<svg class="icon-cpu" fill="currentColor" viewBox="0 0 24 24">
<path d="M4 4h6v6H4V4zm10 0h6v6h-6V4zM4 14h6v6H4v-6zm7 0h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2z"/>
</svg>
<div class="icon-glow cpu-glow"></div>
</div>
<h1 class="title glitch">CYBERSEARCH</h1>
<div class="icon">
<svg class="icon-globe" fill="currentColor" viewBox="0 0 24 24">
<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
</svg>
<div class="icon-glow globe-glow"></div>
</div>
</div>
<p class="subtitle neon-flicker">// SISTEM MENU DIGITAL //</p>
</header>

<!-- Menu Filter -->
<div class="menu-filter">
<div class="filter-container">
<input
type="text"
class="filter-input"
id="filterInput"
placeholder="FILTER MENU (FLEXIBLE)..."
autocomplete="off"
>
<span class="filter-hint">Filter cerdas dengan toleransi kesalahan ketik</span>
</div>
</div>

<!-- Loading Container -->
<div class="loading-container" id="loadingContainer">
<div class="loading-spinner"></div>
<div class="loading-text">MENGAMBIL DATA...</div>
</div>

<!-- Menu Container -->
<div class="menu-container" id="menuContainer" style="display: none;"></div>

<!-- No Menu Items -->
<div class="no-menu" id="noMenu" style="display: none;">
<div class="no-menu-title">TIDAK ADA MENU YANG TERSEDIA</div>
<div class="no-menu-subtitle">PERIKSA KONEKSI ANDA ATAU COBA LAGI NANTI</div>
</div>

<!-- Terminal Output -->
<div class="terminal-output" id="terminalOutput">
<div class="terminal-line"><span class="terminal-prompt">SYSTEM></span> Initializing CYBERSEARCH Engine v2.0.77</div>
<div class="terminal-line"><span class="terminal-prompt">SYSTEM></span> Neural network connection established</div>
<div class="terminal-line"><span class="terminal-prompt">SYSTEM></span> Ready for menu access...</div>
</div>

<!-- Footer -->
<footer class="footer">
<p class="footer-text">&lt; CYBERSEARCH ENGINE v2.0.77 &gt;</p>
</footer>
</div>

<!-- Detail Modal -->
<div class="detail-modal" id="detailModal">
<div class="detail-content">
<div class="detail-header">
<h2 class="detail-title" id="detailTitle">MENU TITLE</h2>
<button class="detail-close" id="detailClose">
<svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
</svg>
</button>
</div>
<div class="detail-body">
<div class="detail-text" id="detailText">MENU CONTENT</div>
</div>
<div class="detail-actions">
<button class="copy-button" id="copyButton">
<svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 4px;">
<path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
</svg>
SALIN
</button>
<span id="copySuccess" class="copy-success">Tersalin!</span>
</div>
</div>
</div>

<!-- Debug Toggle -->
<button class="debug-toggle" id="debugToggle">DEBUG</button>

<!-- Debug Panel -->
<div class="debug-panel" id="debugPanel">
<div class="debug-title">DEBUG INFO</div>
<div class="debug-info" id="debugInfo">Loading...</div>
</div>

<script>
let sheetData = [];
let filteredData = [];
let currentDetail = null;
let debugMode = false;

// Create particle effect
function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = 80;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Random size
        const size = Math.random() * 8 + 1;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // Random position
        particle.style.left = `${Math.random() * 100}%`;
        
        // Random animation delay
        particle.style.animationDelay = `${Math.random() * 20}s`;
        
        // Random animation duration
        particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
        
        particlesContainer.appendChild(particle);
    }
}

// Update system time
function updateSystemTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('id-ID', { hour12: false });
    document.getElementById('systemTime').textContent = timeString;
}

// Update system status
function updateSystemStatus(status, type = 'normal') {
    const statusElement = document.getElementById('systemStatus');
    statusElement.textContent = status;
    
    // Add color based on type
    statusElement.style.color = type === 'error' ? '#ff4444' : 
                               type === 'success' ? 'var(--accent-color)' : 
                               type === 'warning' ? '#ffaa00' : 
                               'var(--primary-color)';
}

// Show terminal output
function showTerminalOutput() {
    const terminal = document.getElementById('terminalOutput');
    terminal.style.display = 'block';
}

// Add line to terminal
function addTerminalLine(text, type = 'normal') {
    const terminal = document.getElementById('terminalOutput');
    const line = document.createElement('div');
    line.classList.add('terminal-line');
    
    let className = 'terminal-prompt';
    if (type === 'error') className = 'terminal-error';
    else if (type === 'success') className = 'terminal-success';
    else if (type === 'warning') className = 'terminal-warning';
    
    line.innerHTML = `<span class="${className}">SYSTEM></span> ${text}`;
    terminal.appendChild(line);
    terminal.scrollTop = terminal.scrollHeight;
}

// Update debug info
function updateDebugInfo() {
    if (!debugMode) return;
    
    const debugInfo = document.getElementById('debugInfo');
    debugInfo.innerHTML = `
        <div>Total Data: ${sheetData.length}</div>
        <div>Filtered Data: ${filteredData.length}</div>
        <div>Current Detail: ${currentDetail ? currentDetail.title : 'None'}</div>
        <div>Cache: ${localStorage.getItem('cybersearch_data') ? 'Available' : 'Empty'}</div>
    `;
}

// Levenshtein distance algorithm for fuzzy matching
function levenshteinDistance(str1, str2) {
    const matrix = [];
    
    for (let i = 0; i <= str2.length; i++) {
        matrix[i] = [i];
    }
    
    for (let j = 0; j <= str1.length; j++) {
        matrix[0][j] = j;
    }
    
    for (let i = 1; i <= str2.length; i++) {
        for (let j = 1; j <= str1.length; j++) {
            if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                matrix[i][j] = matrix[i - 1][j - 1];
            } else {
                matrix[i][j] = Math.min(
                    matrix[i - 1][j - 1] + 1,
                    matrix[i][j - 1] + 1,
                    matrix[i - 1][j] + 1
                );
            }
        }
    }
    
    return matrix[str2.length][str1.length];
}

// Calculate similarity percentage
function calculateSimilarity(str1, str2) {
    const distance = levenshteinDistance(str1.toLowerCase(), str2.toLowerCase());
    const longer = str1.length > str2.length ? str1 : str2;
    const shorter = str1.length > str2.length ? str2 : str1;
    
    if (longer.length === 0) return 100;
    
    return Math.round(((longer.length - distance) / longer.length) * 100);
}

// Enhanced fuzzy matching function
function fuzzyMatch(query, text) {
    const queryLower = query.toLowerCase();
    const textLower = text.toLowerCase();
    
    // Direct match (highest priority)
    if (textLower.includes(queryLower)) {
        return { match: true, score: 100, type: 'exact' };
    }
    
    // Split text into words
    const words = textLower.split(/\s+/);
    
    // Check each word for fuzzy match
    let bestMatch = { match: false, score: 0, type: 'none' };
    
    for (const word of words) {
        // Check if word starts with query
        if (word.startsWith(queryLower)) {
            const score = Math.round((queryLower.length / word.length) * 100);
            if (score > bestMatch.score) {
                bestMatch = { match: true, score, type: 'prefix' };
            }
        }
        
        // Check fuzzy similarity
        const similarity = calculateSimilarity(queryLower, word);
        if (similarity >= 60 && similarity > bestMatch.score) { // 60% similarity threshold
            bestMatch = { match: true, score: similarity, type: 'fuzzy' };
        }
        
        // Check if query is contained in word
        if (word.includes(queryLower)) {
            const score = Math.round((queryLower.length / word.length) * 90);
            if (score > bestMatch.score) {
                bestMatch = { match: true, score, type: 'contains' };
            }
        }
    }
    
    return bestMatch;
}

// Fetch data from Google Sheets with multiple fallback methods
async function fetchSheetData() {
    const sheetId = '1k5U_YwloyQsad7PT_DmXobkNycJ6bsV0zhE00TLmSIg';
    
    updateSystemStatus('MENGAMBIL DATA...', 'warning');
    addTerminalLine('Attempting to connect to database...', 'warning');
    
    // Method 1: Try to access the first sheet by gid=0
    try {
        addTerminalLine('Method 1: Accessing sheet by gid=0...', 'normal');
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=0`;
        
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const text = await response.text();
        
        // Check if we got valid data
        if (text.includes('google.visualization.Query.setResponse')) {
            const json = JSON.parse(text.substring(47).slice(0, -2));
            const rows = json.table.rows;
            
            sheetData = [];
            for (let i = 0; i < rows.length; i++) {
                const titleCell = rows[i].c[0];
                const infoCell = rows[i].c[1];
                
                const title = titleCell && titleCell.v ? String(titleCell.v) : '';
                const info = infoCell && infoCell.v ? String(infoCell.v) : '';
                
                if (title) {
                    sheetData.push({ title: title.trim(), info: info.trim() });
                }
            }
            
            if (sheetData.length > 0) {
                addTerminalLine(`SUCCESS: Loaded ${sheetData.length} menu items from database`, 'success');
                updateSystemStatus('SISTEM ONLINE', 'success');
                localStorage.setItem('cybersearch_data', JSON.stringify(sheetData));
                localStorage.setItem('cybersearch_timestamp', new Date().toISOString());
                filteredData = [...sheetData];
                displayMenuItems();
                updateDebugInfo();
                return;
            }
        }
    } catch (error) {
        addTerminalLine(`Method 1 failed: ${error.message}`, 'error');
        console.error('Method 1 error:', error);
    }
    
    // Method 2: Try to access by sheet name "REPORTAN"
    try {
        addTerminalLine('Method 2: Accessing sheet by name "REPORTAN"...', 'normal');
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=REPORTAN`;
        
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const text = await response.text();
        
        // Check if we got valid data
        if (text.includes('google.visualization.Query.setResponse')) {
            const json = JSON.parse(text.substring(47).slice(0, -2));
            const rows = json.table.rows;
            
            sheetData = [];
            for (let i = 0; i < rows.length; i++) {
                const titleCell = rows[i].c[0];
                const infoCell = rows[i].c[1];
                
                const title = titleCell && titleCell.v ? String(titleCell.v) : '';
                const info = infoCell && infoCell.v ? String(infoCell.v) : '';
                
                if (title) {
                    sheetData.push({ title: title.trim(), info: info.trim() });
                }
            }
            
            if (sheetData.length > 0) {
                addTerminalLine(`SUCCESS: Loaded ${sheetData.length} menu items from REPORTAN sheet`, 'success');
                updateSystemStatus('SISTEM ONLINE', 'success');
                localStorage.setItem('cybersearch_data', JSON.stringify(sheetData));
                localStorage.setItem('cybersearch_timestamp', new Date().toISOString());
                filteredData = [...sheetData];
                displayMenuItems();
                updateDebugInfo();
                return;
            }
        }
    } catch (error) {
        addTerminalLine(`Method 2 failed: ${error.message}`, 'error');
        console.error('Method 2 error:', error);
    }
    
    // Method 3: Try to get all sheets and access the first one
    try {
        addTerminalLine('Method 3: Getting all sheets...', 'normal');
        const feedUrl = `https://spreadsheets.google.com/feeds/worksheets/${sheetId}/public/basic?alt=json`;
        
        const response = await fetch(feedUrl);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const feedJson = await response.json();
        if (feedJson.feed && feedJson.feed.entry && feedJson.feed.entry.length > 0) {
            // Get the first sheet
            const firstSheet = feedJson.feed.entry[0];
            const sheetName = firstSheet.title.$t;
            
            addTerminalLine(`Found sheet: ${sheetName}`, 'normal');
            
            // Now try to access this sheet
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
            
            const sheetResponse = await fetch(url);
            if (!sheetResponse.ok) {
                throw new Error(`HTTP error! status: ${sheetResponse.status}`);
            }
            
            const sheetText = await sheetResponse.text();
            
            // Check if we got valid data
            if (sheetText.includes('google.visualization.Query.setResponse')) {
                const json = JSON.parse(sheetText.substring(47).slice(0, -2));
                const rows = json.table.rows;
                
                sheetData = [];
                for (let i = 0; i < rows.length; i++) {
                    const titleCell = rows[i].c[0];
                    const infoCell = rows[i].c[1];
                    
                    const title = titleCell && titleCell.v ? String(titleCell.v) : '';
                    const info = infoCell && infoCell.v ? String(infoCell.v) : '';
                    
                    if (title) {
                        sheetData.push({ title: title.trim(), info: info.trim() });
                    }
                }
                
                if (sheetData.length > 0) {
                    addTerminalLine(`SUCCESS: Loaded ${sheetData.length} menu items from ${sheetName} sheet`, 'success');
                    updateSystemStatus('SISTEM ONLINE', 'success');
                    localStorage.setItem('cybersearch_data', JSON.stringify(sheetData));
                    localStorage.setItem('cybersearch_timestamp', new Date().toISOString());
                    filteredData = [...sheetData];
                    displayMenuItems();
                    updateDebugInfo();
                    return;
                }
            }
        }
    } catch (error) {
        addTerminalLine(`Method 3 failed: ${error.message}`, 'error');
        console.error('Method 3 error:', error);
    }
    
    // Method 4: Try to load from cache
    try {
        addTerminalLine('Method 4: Loading from cache...', 'normal');
        const cachedData = localStorage.getItem('cybersearch_data');
        if (cachedData) {
            sheetData = JSON.parse(cachedData);
            const timestamp = localStorage.getItem('cybersearch_timestamp');
            addTerminalLine(`SUCCESS: Loaded ${sheetData.length} menu items from cache (${new Date(timestamp).toLocaleString()})`, 'success');
            updateSystemStatus('SISTEM ONLINE (OFFLINE)', 'warning');
            filteredData = [...sheetData];
            displayMenuItems();
            updateDebugInfo();
            return;
        }
    } catch (error) {
        addTerminalLine(`Method 4 failed: ${error.message}`, 'error');
        console.error('Method 4 error:', error);
    }
    
    // Method 5: Use sample data as last resort
    addTerminalLine('Method 5: Using sample data...', 'warning');
    sheetData = [
        { title: "MENU SAMPLE 1", info: "Ini adalah contoh menu karena database tidak dapat dijangkau. Silakan periksa koneksi internet Anda atau URL spreadsheet." },
        { title: "MENU SAMPLE 2", info: "Sistem saat ini berjalan dalam mode offline dengan fungsionalitas terbatas." },
        { title: "KESALAHAN KONEKSI", info: "Tidak dapat terhubung ke database Google Sheets. Silakan verifikasi ID spreadsheet dan pastikan dapat diakses publik." }
    ];
    
    addTerminalLine(`WARNING: Using ${sheetData.length} sample menu items`, 'warning');
    updateSystemStatus('SISTEM OFFLINE', 'error');
    filteredData = [...sheetData];
    displayMenuItems();
    updateDebugInfo();
}

// Display menu items
function displayMenuItems() {
    const container = document.getElementById('menuContainer');
    const loadingContainer = document.getElementById('loadingContainer');
    const noMenu = document.getElementById('noMenu');
    
    loadingContainer.style.display = 'none';
    
    if (filteredData.length === 0) {
        container.style.display = 'none';
        noMenu.style.display = 'block';
        return;
    }
    
    container.style.display = 'grid';
    noMenu.style.display = 'none';
    
    container.innerHTML = filteredData.map((item, index) => `
        <div class="menu-card" data-index="${index}">
            <div class="match-indicator">${item.matchType || 'MATCH'}</div>
            <div class="menu-icon">
                <svg fill="currentColor" viewBox="0 0 24 24">
                    <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
                </svg>
            </div>
            <h3 class="menu-title">${item.title}</h3>
            <div class="menu-preview">${item.info}</div>
            <div class="menu-badge">MENU #${index + 1}</div>
        </div>
    `).join('');
    
    // Add click event listeners to menu cards
    container.querySelectorAll('.menu-card').forEach(card => {
        card.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            showDetail(filteredData[index]);
        });
    });
}

// Show detail modal
function showDetail(item) {
    currentDetail = item;
    const modal = document.getElementById('detailModal');
    const title = document.getElementById('detailTitle');
    const text = document.getElementById('detailText');
    
    title.textContent = item.title;
    text.textContent = item.info;
    
    modal.classList.add('show');
    updateDebugInfo();
    
    addTerminalLine(`Opening menu: ${item.title}`, 'normal');
}

// Hide detail modal
function hideDetail() {
    const modal = document.getElementById('detailModal');
    modal.classList.remove('show');
    currentDetail = null;
    updateDebugInfo();
}

// Copy to clipboard
function copyToClipboard() {
    if (!currentDetail) return;
    
    navigator.clipboard.writeText(currentDetail.info).then(() => {
        // Show success message
        const successElement = document.getElementById('copySuccess');
        successElement.classList.add('show');
        
        // Add to terminal
        addTerminalLine(`Data copied to clipboard: ${currentDetail.info.substring(0, 50)}${currentDetail.info.length > 50 ? '...' : ''}`, 'success');
        
        // Hide success message after 2 seconds
        setTimeout(() => {
            successElement.classList.remove('show');
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy: ', err);
        addTerminalLine(`ERROR: Failed to copy text - ${err.message}`, 'error');
    });
}

// Enhanced filter menu items with fuzzy matching
function filterMenuItems() {
    const query = document.getElementById('filterInput').value.trim();
    
    if (query === '') {
        filteredData = sheetData.map(item => ({ ...item }));
    } else {
        const results = [];
        
        for (const item of sheetData) {
            // Check title match
            const titleMatch = fuzzyMatch(query, item.title);
            
            // Check info match
            const infoMatch = fuzzyMatch(query, item.info);
            
            // Use the best match
            const bestMatch = titleMatch.score > infoMatch.score ? titleMatch : infoMatch;
            
            if (bestMatch.match) {
                // Add match type and score to item
                const enhancedItem = {
                    ...item,
                    matchScore: bestMatch.score,
                    matchType: bestMatch.type.toUpperCase()
                };
                results.push(enhancedItem);
            }
        }
        
        // Sort by score (highest first)
        results.sort((a, b) => b.matchScore - a.matchScore);
        
        filteredData = results;
    }
    
    displayMenuItems();
    updateDebugInfo();
    
    addTerminalLine(`Fuzzy filter applied: "${query}" (${filteredData.length} results)`, 'normal');
}

// Fetch data when page loads
window.onload = function() {
    createParticles();
    updateSystemTime();
    setInterval(updateSystemTime, 1000);
    showTerminalOutput();
    
    // Debug toggle
    document.getElementById('debugToggle').addEventListener('click', function() {
        debugMode = !debugMode;
        const debugPanel = document.getElementById('debugPanel');
        debugPanel.classList.toggle('show', debugMode);
        updateDebugInfo();
    });
    
    // Update debug info periodically
    setInterval(updateDebugInfo, 1000);
    
    // Filter input with debouncing
    let debounceTimer;
    document.getElementById('filterInput').addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(filterMenuItems, 300);
    });
    
    // Detail modal close button
    document.getElementById('detailClose').addEventListener('click', hideDetail);
    
    // Copy button
    document.getElementById('copyButton').addEventListener('click', copyToClipboard);
    
    // Close modal when clicking outside
    document.getElementById('detailModal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideDetail();
        }
    });
    
    // Fetch data
    fetchSheetData();
};
</script>
</body>
</html>
